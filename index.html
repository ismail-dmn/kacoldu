<!DOCTYPE html>
<html lang="tr">
<!-- Senin tam head ve body yapın aynı, kısaltarak gösteriyorum -->
<body>
    <!-- Senin header, main, table'ler aynı (data-code'lu elementler) -->

    <!-- Scripts (orijinal + yeni fallback) -->
    <script src="scripts/socket.io.min.js" defer></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" crossorigin="anonymous"></script>
    <script src="scripts/main.min.js" async></script>

    <!-- YENİ: Canlı Güncelleme Fallback (TCMB + GoldAPI) -->
    <script>
    // GoldAPI key'in (ücretsiz kayıt: https://www.goldapi.io/)
    const GOLD_API_KEY = 'goldapi-XXX-YYY-IO'; // Buraya kendi key'ini koy

    function updatePrices() {
        // TCMB Döviz (Ücretsiz, resmi)
        fetch('https://cors-proxy.example.com/https://www.tcmb.gov.tr/kurlar/today.xml') // CORS için proxy kullan veya sunucunda proxyle
        .then(r => r.text())
        .then(str => {
            let parser = new DOMParser();
            let xml = parser.parseFromString(str, "text/xml");
            
            // USD
            let usdBuy = xml.querySelector('Currency[Kod="USD"] ForexBuying').textContent;
            let usdSell = xml.querySelector('Currency[Kod="USD"] ForexSelling').textContent;
            updateElement('USD', usdBuy, usdSell, calculatePercent(usdSell, 'previous_usd')); // % için önceki cache
            
            // EUR benzer
            let eurBuy = xml.querySelector('Currency[Kod="EUR"] ForexBuying').textContent;
            let eurSell = xml.querySelector('Currency[Kod="EUR"] ForexSelling').textContent;
            updateElement('EUR', eurBuy, eurSell);
            
            // Diğer dövizler için loop ekle (GBP, CHF vb.)
        })
        .catch(err => console.error('TCMB hatası:', err));

        // Altın (GoldAPI - Ons'tan Gram hesapla)
        fetch('https://www.goldapi.io/api/XAU/TRY', {
            headers: { 'x-access-token': GOLD_API_KEY }
        })
        .then(r => r.json())
        .then(data => {
            let onsTL = data.price;
            let gramTL = (onsTL / 31.1035).toFixed(4); // 1 ons = 31.1035 gram
            updateElement('GA', gramTL, gramTL); // Alış/satış aynı kabul
            // Çeyrek: gram * 1.606 (yaklaşık), Cumhuriyet vb. hesapla
            let ceyrek = (gramTL * 7 / 4.608).toFixed(4); // Standart hesaplama
            updateElement('C', ceyrek, ceyrek);
        })
        .catch(err => console.error('Altın hatası:', err));
    }

    function updateElement(code, buy, sell, percent = '') {
        // Alış
        document.querySelectorAll(`[data-code="${code}"] .text-primary`).forEach(el => el.innerText = buy);
        // Satış ve değerler
        document.querySelectorAll(`[data-code="${code}"] .currency-value, [data-code="${code}"] .canli`).forEach(el => el.innerText = sell);
        // % değişim (basit örnek)
        if (percent) document.querySelectorAll(`[data-code="${code}"] .currency-ratio, .status-up`).forEach(el => el.innerText = `% ${percent}`);
        // Up/down class
        let status = percent > 0 ? 'status-up' : 'status-down';
        document.querySelectorAll(`[data-code="${code}"] li, tr`).forEach(el => el.classList.add(status));
    }

    // % hesapla (önceki değer cache'le)
    let previous = {};
    function calculatePercent(current, code) {
        if (previous[code]) {
            return ((current - previous[code]) / previous[code] * 100).toFixed(2);
        }
        previous[code] = current;
        return '0.00';
    }

    // Sayfa yüklenince ve her 60 sn'de çalıştır
    document.addEventListener('DOMContentLoaded', updatePrices);
    setInterval(updatePrices, 60000); // 1 dakika

    // Hata gösterisi
    window.addEventListener('error', () => alert('Veri yüklenemedi, yenile!'));
    </script>

    <!-- Diğer script'ler (clock, theme vb.) aynı -->
</body>
</html>
